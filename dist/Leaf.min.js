var w={},i=new WeakMap,g=!1,f=new Set,u=new Set;function q(e,o){w[e]=o}function _(){g||(g=!0,queueMicrotask(()=>{g=!1,u.forEach(e=>d(e,"disconnect")),f.forEach(e=>{u.has(e)||d(e,"connect")}),f.clear(),u.clear()}))}function $(e){let o=new Proxy({},{get:(c,n)=>e.querySelector(`[data-target="${String(n)}"]`)}),t=new Proxy({},{get:(c,n)=>e.querySelectorAll(`[data-target="${String(n)}"]`)});return new Proxy({},{get:(c,n)=>n==="all"?t:o[n]})}function d(e,o){let t=e.dataset.scope,c=w[t];if(!c){console.error(`Scope ${t} not found`);return}let n=i.get(e);o==="connect"?n||(n=c({root:e,targets:new Proxy({},{get:(p,r)=>$(e)}),values:new Proxy({},{get:(p,r)=>e.dataset[r],set:(p,r,m)=>(e.dataset[r]=m,!0)})}),i.set(e,n),typeof n.connect=="function"&&n.connect()):o==="disconnect"&&n&&typeof n.disconnect=="function"&&(n.disconnect(),i.delete(e))}var x=new MutationObserver(e=>{e.forEach(o=>{o.addedNodes.forEach(t=>{t.nodeType===1&&(t.matches("[data-scope]")&&f.add(t),t.querySelectorAll("[data-scope]").forEach(c=>f.add(c)))}),o.removedNodes.forEach(t=>{t.nodeType===1&&(t.matches("[data-scope]")&&u.add(t),t.querySelectorAll("[data-scope]").forEach(c=>u.add(c)))})}),_()});function b(){x.observe(document.body,{childList:!0,subtree:!0}),document.querySelectorAll("[data-scope]").forEach(o=>d(o,"connect")),["click","submit","input","change"].forEach(o=>{document.addEventListener(o,t=>{let c=t.target.closest(`[data-action*="${o}->"]`);if(!c)return;c.dataset.action.split(/\s+/).filter(r=>r.startsWith(`${o}->`)).forEach(r=>{let[m,l]=r.split("->").map(a=>a.trim()),s=c.closest("[data-scope]");if(!s)return;let y=s.dataset.scope;i.has(s)||d(s,"connect");let S={element:c,event:t,params:new Proxy({},{get:(a,h)=>c.dataset[h],set:(a,h,v)=>(c.dataset[h]=v,!0)})},E=i.get(s);E[l]||console.warn(`scope:${y} method "${l}" not found`);try{E[l](S)}catch(a){console.error(`[scope:${y}] ${l}() failed`,a)}})},{capture:!0})})}document.addEventListener("DOMContentLoaded",()=>{b()});export{q as defineScope};
