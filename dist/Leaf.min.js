var v={},i=new WeakMap,m=!1,d=new Set,u=new Set;function A(e,c){v[e]=c}function w(){m||(m=!0,queueMicrotask(()=>{m=!1,u.forEach(e=>f(e,"disconnect")),d.forEach(e=>{u.has(e)||f(e,"connect")}),d.clear(),u.clear()}))}function f(e,c){let t=e.dataset.scope,o=v[t];if(!o){console.error(`Scope ${t} not found`);return}let s=i.get(e);c==="connect"?s||(s=o({root:e,targets:new Proxy({},{get:(h,n)=>n.endsWith("s")?e.querySelectorAll(`[data-target="${n}"]`):e.querySelector(`[data-target="${n}"]`)}),values:new Proxy({},{get:(h,n)=>e.dataset[n],set:(h,n,E)=>(e.dataset[n]=E,!0)})}),i.set(e,s),typeof s.connect=="function"&&s.connect()):c==="disconnect"&&s&&typeof s.disconnect=="function"&&(s.disconnect(),i.delete(e))}var b=new MutationObserver(e=>{e.forEach(c=>{c.addedNodes.forEach(t=>{t.nodeType===1&&(t.matches("[data-scope]")&&d.add(t),t.querySelectorAll("[data-scope]").forEach(o=>d.add(o)))}),c.removedNodes.forEach(t=>{t.nodeType===1&&(t.matches("[data-scope]")&&u.add(t),t.querySelectorAll("[data-scope]").forEach(o=>u.add(o)))})}),w()});function q(){b.observe(document.body,{childList:!0,subtree:!0}),document.querySelectorAll("[data-scope]").forEach(c=>f(c,"connect")),["click","submit","input","change"].forEach(c=>{document.addEventListener(c,t=>{let o=t.target.closest(`[data-action*="${c}->"]`);if(!o)return;o.dataset.action.split(/\s+/).filter(n=>n.startsWith(`${c}->`)).forEach(n=>{let[E,l]=n.split("->").map(r=>r.trim()),a=o.closest("[data-scope]");if(!a)return;let g=a.dataset.scope;i.has(a)||f(a,"connect");let S={element:o,event:t,params:new Proxy({},{get:(r,p)=>o.dataset[p],set:(r,p,$)=>(o.dataset[p]=$,!0)})},y=i.get(a);y[l]||console.warn(`scope:${g} method "${l}" not found`);try{y[l](S)}catch(r){console.error(`[scope:${g}] ${l}() failed`,r)}})},{capture:!0})})}document.addEventListener("DOMContentLoaded",()=>{q()});export{A as defineScope};
